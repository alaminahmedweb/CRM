@model Web.ViewModels.BookingVM
@inject UserManager<ApplicationUser> userManager;

@{
    ViewData["Title"] = "Add Booking";
    var bookingItems = @ViewBag.BookingItems;
    var userid = "";
    if (User.Identity.IsAuthenticated)
    {
        userid = userManager.GetUserId(User);
    }

}

<div class="row">
    <div class="col-lg-6 col-md-6 col-sm-12 col-12 bg-white">
        <h5 class="text-center  text-bg-secondary pb-2 pt-1">Customer Information</h5>
        <div class="table-responsive">
            <table class="table table-user-information">
                <tbody>
                    <tr>
                        <td>
                            Name
                        </td>
                        <td class="text-primary">
                            @Model.Name
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Category
                        </td>
                        <td class="text-primary">
                            unknown
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Reference
                        </td>
                        <td class="text-primary">
                            unknown
                        </td>
                    </tr>

                    <tr>
                        <td>
                            Contact
                        </td>
                        <td class="text-primary">
                            @Model.ContactName
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Marketing
                        </td>
                        <td class="text-primary">
                            @Model.EmployeeName
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="col-lg-6 col-md-6 col-sm-12 col-12 bg-white pl-5 pr-5">
        <h5 class="text-center  text-bg-secondary pb-2 pt-1">Contact Information</h5>
        <div class="table-responsive">
            <table class="table table-user-information">
                <tbody>
                    <tr style="font-weight:bold;font-size:12px;">
                        <td>Contract Person</td>
                        <td>Designation</td>
                        <td>Mobile No</td>
                    </tr>
                    @if (Model.ContractDetails != null)
                    {
                        @foreach (var item in Model.ContractDetails)
                        {
                            <tr>
                                <td>@item.Name</td>
                                <td>@item.Designation</td>
                                <td>@item.MobileNo</td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-lg-6 col-md-6 col-sm-12 col-12 bg-white">
        <h5 class="text-center  text-bg-secondary pb-2 pt-1">Address</h5>
        <div class="table-responsive">
            <table class="table table-user-information">
                <tbody>
                    <tr>
                        <td>
                            Location
                        </td>
                        <td class="text-primary">
                            @Model.Address
                        </td>
                    </tr>
                    <tr>
                        <td>
                            City
                        </td>
                        <td class="text-primary">
                            @Model.CityName
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Area
                        </td>
                        <td class="text-primary">
                            @Model.AreaName
                        </td>
                    </tr>

                    <tr>
                        <td>
                            Sub Area
                        </td>
                        <td class="text-primary">
                            @Model.SubAreaName
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="col-lg-6 col-md-6 col-sm-12 col-12 bg-white">
        <h5 class="text-center  text-bg-secondary pb-2 pt-1">Building Details</h5>
        <div class="table-responsive">
            <table class="table table-user-information">
                <tbody>
                    <tr>
                        <td>
                            Floor No
                        </td>
                        <td class="text-primary">
                            @Model.NoOfFloor
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Flat No
                        </td>
                        <td class="text-primary">
                            @Model.NoOfFlat
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="table-responsive">
            <table class="table table-user-information">
                <tbody id="tblBuldingDetails">
                    <tr style="font-weight:bold;font-size:12px;">
                        <td class="col-7">Brand Name</td>
                        <td class="col-2">Quantity</td>
                        <td class="col-2">Capacity</td>
                    </tr>

                    @if (Model.BuildingDetails != null)
                    {
                        @foreach (var item in Model.BuildingDetails)
                        {
                            <tr>
                                <td>@item.BrandName</td>
                                <td>@item.Quantity</td>
                                <td>@item.Capacity</td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-lg-12 col-md-6 col-sm-12 col-12 bg-white">
        <h5 class="text-center  text-bg-secondary pb-2 pt-1">Followup Information</h5>
    </div>
</div>
<div class="row">
    <div class="col-lg-6 col-md-6 col-sm-12 col-12 bg-white">
        <div class="table-responsive">
            <table class="table table-user-information">
                <tbody>
                    <tr>
                        <td>
                            Calling Date
                        </td>
                        <td class="text-primary">
                            @Model.CallingDate
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Followup Date
                        </td>
                        <td class="text-primary">
                            @Model.FollowupCallDate
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Working Month
                        </td>
                        <td class="text-primary">
                            @Model.CustomerDoTheWorkingMonthName
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Discussion Details
                        </td>
                        <td class="text-primary">
                            @Model.DiscussionDetailsNote
                        </td>
                    </tr>

                    <tr>
                        <td>
                            Service Name
                        </td>
                        <td class="text-primary">
                            @Model.ServiceName
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="col-lg-6 col-md-6 col-sm-12 col-12 bg-white">
        <div class="table-responsive">
            <table class="table table-user-information">
                <tbody>

                    <tr>
                        <td>
                            Next Plan
                        </td>
                        <td class="text-primary">
                            @Model.MarketingNextPlan
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Remarks
                        </td>
                        <td class="text-primary">
                            @Model.Remarks
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Offer Amount
                        </td>
                        <td class="text-primary">
                            @Model.OfferAmount
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Booking Amount
                        </td>
                        <td class="text-primary">
                            @Model.AgreeAmount
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="row bg-white">
    <form asp-action="SaveBooking" autocomplete="off">
        <div asp-validation-summary="ModelOnly" class="text-danger" id="validationSummary"></div>
        <input asp-for="@Model.CustomerId" hidden class="col-sm-2 form-control" />
        <input asp-for="@Model.FollowupId" class="col-sm-3 form-control" hidden />
        <input type="hidden" asp-for="ModifiedBy" value="@userid" />


        <h4 style="font-family:Verdana;margin-left:-10px;font-size: 18px;" class="mt-5">Add New Booking</h4>
        <div class="form-group row mt-2 ml-1 mr-1">

            <div class="col-lg-3 col-md-6 col-sm-6 col-12">
                <div class="form-floating">
                    <input class="form-control" asp-for="BookingDate" placeholder="Booking Date" />
                    <label for="BookingDate">Booking Date</label>
                </div>
                <span asp-validation-for="BookingDate" class="text-danger"></span>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6 col-12">
                <div class="form-floating">
                    <select asp-for="@Model.TeamId" class="form-control">
                        <option value="-1">Select Team</option>
                        @foreach (var item in @ViewBag.TeamInfo)
                        {
                            <option value="@item.Id">@item.Name</option>
                        }
                    </select>
                    <label asp-for="TeamId">Team</label>
                </div>
                <span asp-validation-for="TeamId" class="text-danger"></span>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6 col-12">
                <div class="form-floating">
                    <select asp-for="@Model.ShiftId" class="form-control">
                        <option value="-1">Select Shift</option>
                        <option value="1">Morning</option>
                        <option value="2">Evening</option>
                    </select>
                    <label asp-for="ShiftId">Shift</label>
                </div>
                <span asp-validation-for="ShiftId" class="text-danger"></span>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6 col-12">
                <div class="form-floating">
                    <input class="form-control" asp-for="EntryDate" placeholder="Entry Date" />
                    <label for="EntryDate">Entry Date</label>
                </div>
                <span asp-validation-for="EntryDate" class="text-danger"></span>
            </div>
        </div>



        <div class="form-group row mt-2">
            <div class="col-lg-3 col-md-6 col-sm-6 col-12">
                <div class="form-floating">
                    <select asp-for="BookingById" class="form-control" title="searchableDropdown">
                        <option value="-1">Select Mpo</option>
                        @foreach (var data in ViewBag.EmployeeList)
                        {
                            <option value="@data.Id">@data.Name</option>
                        }
                    </select>
                    <label asp-for="BookingById">Booking By</label>
                </div>
            </div>
            <div class="col-lg-9 col-md-6 col-sm-6 col-12">
                <div class="form-floating">
                    <input class="form-control" asp-for="BookingNote" placeholder="Booking Note" />
                    <label for="BookingNote">Booking Note</label>
                </div>
                <span asp-validation-for="BookingNote" class="text-danger"></span>
            </div>
        </div>

        <div class="form-group text-center mb-1">
            <input type="submit" value="Save" asp-action="SaveBooking" asp-controller="Booking" class="btn btn-primary" />
        </div>
    </form>
</div>
@*
<div class="row">
    <div class="col-12">
        <div class="box box-success">
            <div class="box-header" style="border-bottom:1px solid black">
                <p>Add New Booking</p>
            </div>
            <div class="box-body">
                <form asp-action="SaveBooking">
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                    <input asp-for="@Model.CustomerId" hidden class="col-sm-2 form-control" />
                    <input asp-for="@Model.FollowupId" class="col-sm-3 form-control" hidden />
                    <input type="hidden" asp-for="ModifiedBy" value="@userid" />



                    <div class="form-group row mt-1">
                        <label asp-for="@Model.EntryDate" class="col-sm-1 control-label">Entry Date</label>
                        <div class="col-2">
                            <input asp-for="@Model.EntryDate" class="form-control" />
                        </div>
                    </div>
                    <hr />
                    <div class="form-group row">
                        <label asp-for="@Model.BookingDate" class="col-sm-2 control-label">Working Date</label>
                        <div class="col-2">
                            <input asp-for="@Model.BookingDate" class="form-control" />
                            <span asp-validation-for="@Model.BookingDate" class="text-danger"></span>
                        </div>
                        <label asp-for="@Model.TeamId" class="control-label ml-2">Team</label>
                        <div class="col-2">
                            <select asp-for="@Model.TeamId" class="form-control">
                                <option value="-1">Select Team</option>
                                @foreach (var item in @ViewBag.TeamInfo)
                                {
                                    <option value="@item.Id">@item.Name</option>
                                }
                            </select>
                            <span asp-validation-for="TeamId" class="text-danger"></span>
                        </div>
                        <label asp-for="@Model.ShiftId" class="control-label ml-2">Shift</label>
                        <div class="col-2">
                            <select asp-for="@Model.ShiftId" class="form-control">
                                <option value="-1">Select Shift</option>
                                <option value="1">Morning</option>
                                <option value="2">Evening</option>
                            </select>
                            <span asp-validation-for="ShiftId" class="text-danger"></span>
                        </div>
                        <label asp-for="BookingById" class="control-label ml-2">Booking By</label>
                        <div class="col-2">
                            <select asp-for="BookingById" class="form-control" title="searchableDropdown">
                                <option value="-1">Select Mpo</option>
                                @foreach (var data in ViewBag.EmployeeList)
                                {
                                    <option value="@data.Id">@data.Name</option>
                                }
                            </select>
                            <span asp-validation-for="BookingById" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group row mt-1">
                        <label asp-for="BookingNote" class="control-label col-2">Booking Note</label>
                        <div class="col-10">
                            <input asp-for="BookingNote" class="form-control" />
                        </div>
                    </div>
                    <div class="form-group text-center">
                        <input type="submit" value="Save" class="btn btn-primary">
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>*@

<div class="row bg-white mt-2">
    <table class="table table-bordered" id="bookinginfo">
        <thead>
            <tr>
                <th>Working Date</th>
                <th>Team Name</th>
                <th>Shift Name</th>
                <th>Status</th>
                <th>Mobile No</th>
                <th>Organization Name</th>
                <th>Address</th>
                <th>Amount</th>
                <th>Note</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script type="text/javascript">
        $(document).ready(function () {

            //$('[title="searchableDropdown"]').select2();

            var today = new Date();
            var dd = String(today.getDate()).padStart(2, '0');
            var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!

            var currentDate = today.getFullYear() + "-" + mm + "-" + dd;
            $('#BookingDate').val(currentDate);

            var dateFrom = currentDate;
            var dateTo = currentDate;

            $.ajax({
                type: "GET",
                url: "/Booking/ShowBookingData",
                data: { dateFrom: dateFrom, dateTo: dateTo },
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (result) {
                    var bookingTable = $('#bookinginfo tbody');

                    bookingTable.empty();
                    $(result).each(function (index, data) {
                        var bookingDate = "";
                        var trDate = "";
                        if (data.bookingDate != null) {
                            bookingDate = data.bookingDate.substring(0, 10);
                        } else {
                            bookingDate = "";
                        }
                        if (data.trDate != null) {
                            trDate = data.trDate.substring(0, 10);
                        } else {
                            trDate = "";
                        }
                        var bookingNote = "";
                        if (data.bookingNote == null) {
                            bookingNote = "";
                        } else {
                            bookingNote = data.bookingNote;
                        }

                        bookingTable.append('<tr><td>' + trDate + '</td><td>' + data.teamName + '</td><td>' +
                            data.shiftName + '</td><td>' + data.status + '</td><td>' +
                            data.mobileNo + '</td><td>' + data.name + '</td><td>' + data.address + '</td><td>'
                            + data.agreeAmount + '</td><td>' + bookingNote + '</td></tr>');
                    });
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    // handle error
                }
            });


            $('#BookingDate').change(function () {
                $.ajax({
                    type: "GET",
                    url: "/Booking/ShowBookingData",
                    data: { dateFrom: $(this).val(), dateTo: $(this).val() },
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (result) {
                        var bookingTable = $('#bookinginfo tbody');

                        bookingTable.empty();
                        $(result).each(function (index, data) {
                            var bookingDate = "";
                            var trDate = "";
                            if (data.bookingDate != null) {
                                bookingDate = data.bookingDate.substring(0, 10);
                            } else {
                                bookingDate = "";
                            }
                            if (data.trDate != null) {
                                trDate = data.trDate.substring(0, 10);
                            } else {
                                trDate = "";
                            }

                            var bookingNote = "";
                            if (data.bookingNote == null) {
                                bookingNote = "";
                            } else {
                                bookingNote = data.bookingNote;
                            }

                            bookingTable.append('<tr><td>' + trDate + '</td><td>' + data.teamName + '</td><td>' +
                                data.shiftName + '</td><td>' + data.status + '</td><td>' +
                                data.mobileNo + '</td><td>' + data.name + '</td><td>' + data.address + '</td><td>'
                                + data.agreeAmount + '</td><td>' + bookingNote + '</td></tr>');
                        });
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        // handle error
                    }
                });
            });
        });
    </script>
}
